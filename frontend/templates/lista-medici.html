{% extends "layouts/base.html" %}

{% block title %}Elenco Medici - Salus AI{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Trova il Tuo Specialista</h1>
    <p>Esplora la lista dei nostri professionisti e trova quello più adatto a te.</p>
</div>

<div id="medici-container" class="medici-grid">
    <p>Caricamento dei medici in corso...</p>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('DOMContentLoaded', async () => {
        const container = document.getElementById('medici-container');
        try {
            const response = await fetch('/medici/api/list');
            if (!response.ok) throw new Error(`Errore: ${response.status}`);
            const medici = await response.json();
            
            container.innerHTML = '';
            if (medici.length === 0) {
                container.innerHTML = '<p>Nessun medico trovato al momento.</p>';
                return;
            }

            medici.forEach(medico => {
                const card = document.createElement('div');
                card.className = 'medico-card';
                card.dataset.medicoId = medico.id;
                card.innerHTML = `
                    <h2>Dr. ${medico.nome} ${medico.cognome}</h2>
                    <p class="specializzazione">${medico.specializzazione_nome}</p>
                    <p>${medico.citta}</p>
                    <p>${medico.indirizzo_studio}</p>
                    <p class="punteggio">Punteggio: ${medico.punteggio_medio.toFixed(2)} / 5.00</p>
                `;
                
                card.addEventListener('click', () => {
                    const token = localStorage.getItem('user_token');
                    if (token) {
                        // Se l'utente è loggato, va al profilo del medico.
                        window.location.href = `/medici/${medico.id}`;
                    } else {
                        // Se non è loggato, viene reindirizzato alla pagina di login.
                        SalusNotifier.alert("Per visualizzare i dettagli del medico e prenotare una visita, è necessario effettuare l'accesso.", "Accesso Richiesto");
                        // Piccolo ritardo per dare il tempo di leggere la notifica
                        setTimeout(() => {
                           window.location.href = '/pagina-login';
                        }, 2500);
                    }
                });
                container.appendChild(card);
            });

        } catch (error) {
            console.error("Impossibile caricare la lista dei medici:", error);
            container.innerHTML = '<p>Si è verificato un errore durante il caricamento dei medici. Riprova più tardi.</p>';
        }
    });
</script>
{% endblock %}